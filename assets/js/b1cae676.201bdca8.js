"use strict";(globalThis.webpackChunkbook_website=globalThis.webpackChunkbook_website||[]).push([[318],{8453:(n,e,i)=>{i.d(e,{R:()=>a,x:()=>l});var t=i(6540);const s={},o=t.createContext(s);function a(n){const e=t.useContext(o);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:a(n.components),t.createElement(o.Provider,{value:e},n.children)}},8540:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>r,contentTitle:()=>l,default:()=>m,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"module-2/digital-twin-workflows","title":"Digital Twin Workflows","description":"Best practices for digital twin development: validation, continuous integration, and production deployment.","source":"@site/docs/module-2/digital-twin-workflows.md","sourceDirName":"module-2","slug":"/module-2/digital-twin-workflows","permalink":"/physical-ai-robotics-book/docs/module-2/digital-twin-workflows","draft":false,"unlisted":false,"editUrl":"https://github.com/fun33333/physical-ai-robotics-book/tree/main/book-website/docs/module-2/digital-twin-workflows.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"title":"Digital Twin Workflows","sidebar_position":6,"description":"Best practices for digital twin development: validation, continuous integration, and production deployment."},"sidebar":"tutorialSidebar","previous":{"title":"Unity for Robotics","permalink":"/physical-ai-robotics-book/docs/module-2/unity-robotics"},"next":{"title":"Module 3: The AI-Robot Brain (NVIDIA Isaac)","permalink":"/physical-ai-robotics-book/docs/module-3/"}}');var s=i(4848),o=i(8453);const a={title:"Digital Twin Workflows",sidebar_position:6,description:"Best practices for digital twin development: validation, continuous integration, and production deployment."},l="Digital Twin Workflows",r={},d=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"What is a Digital Twin?",id:"what-is-a-digital-twin",level:2},{value:"Beyond Simulation",id:"beyond-simulation",level:3},{value:"Digital Twin Maturity Levels",id:"digital-twin-maturity-levels",level:3},{value:"Validation Workflow",id:"validation-workflow",level:2},{value:"The Validation Pipeline",id:"the-validation-pipeline",level:3},{value:"Defining Validation Metrics",id:"defining-validation-metrics",level:3},{value:"Data Collection Protocol",id:"data-collection-protocol",level:3},{value:"Comparison Analysis",id:"comparison-analysis",level:3},{value:"CI/CD with Simulation-in-the-Loop",id:"cicd-with-simulation-in-the-loop",level:2},{value:"Pipeline Architecture",id:"pipeline-architecture",level:3},{value:"Test Scenarios",id:"test-scenarios",level:3},{value:"Automated Regression Testing",id:"automated-regression-testing",level:3},{value:"Asset Management",id:"asset-management",level:2},{value:"Directory Structure",id:"directory-structure",level:3},{value:"Version Control Best Practices",id:"version-control-best-practices",level:3},{value:"Scaling Simulations",id:"scaling-simulations",level:2},{value:"Parallel Simulation for Training",id:"parallel-simulation-for-training",level:3},{value:"Cloud-Based Simulation",id:"cloud-based-simulation",level:3},{value:"Exercise 1: Validation Pipeline",id:"exercise-1-validation-pipeline",level:2},{value:"Exercise 2: CI/CD Integration",id:"exercise-2-cicd-integration",level:2},{value:"Summary",id:"summary",level:2},{value:"Module 2 Completion",id:"module-2-completion",level:2},{value:"Further Reading",id:"further-reading",level:2}];function c(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"digital-twin-workflows",children:"Digital Twin Workflows"})}),"\n",(0,s.jsx)(e.p,{children:"Creating a simulation is just the beginning - this chapter covers the workflows and practices that make digital twins truly valuable for robotics development. From validation to continuous integration, these practices separate hobby projects from production systems."}),"\n",(0,s.jsx)(e.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(e.p,{children:"In this section, you will:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Understand the complete digital twin lifecycle"}),"\n",(0,s.jsx)(e.li,{children:"Validate simulations against real-world behavior"}),"\n",(0,s.jsx)(e.li,{children:"Set up CI/CD pipelines with simulation-in-the-loop testing"}),"\n",(0,s.jsx)(e.li,{children:"Manage simulation assets alongside code"}),"\n",(0,s.jsx)(e.li,{children:"Scale simulations for parallel training and testing"}),"\n",(0,s.jsx)(e.li,{children:"Monitor and maintain simulation accuracy over time"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(e.p,{children:"Before starting, ensure you have completed:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"/docs/module-2/gazebo-ros2-integration",children:"Gazebo-ROS 2 Integration"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"/docs/module-2/unity-robotics",children:"Unity for Robotics"})}),"\n",(0,s.jsx)(e.li,{children:"Basic understanding of Git and CI/CD concepts"}),"\n"]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"what-is-a-digital-twin",children:"What is a Digital Twin?"}),"\n",(0,s.jsx)(e.h3,{id:"beyond-simulation",children:"Beyond Simulation"}),"\n",(0,s.jsx)(e.p,{children:"A digital twin is more than a simulation - it's a continuously synchronized virtual replica:"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Digital Twin Architecture                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                  \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n\u2502   \u2502   Physical      \u2502   Real-time  \u2502    Digital      \u2502          \u2502\n\u2502   \u2502   Robot         \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502    Twin         \u2502          \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    Sync      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502          \u2502                                  \u2502                    \u2502\n\u2502          \u2502  Sensors      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502  Predictions      \u2502\n\u2502          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  Data    \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2518                    \u2502\n\u2502                          \u2502  Lake    \u2502                           \u2502\n\u2502                          \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502\n\u2502                               \u2502                                  \u2502\n\u2502                     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                       \u2502\n\u2502                     \u2502   Analytics &     \u2502                       \u2502\n\u2502                     \u2502   ML Training     \u2502                       \u2502\n\u2502                     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                       \u2502\n\u2502                                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(e.h3,{id:"digital-twin-maturity-levels",children:"Digital Twin Maturity Levels"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"Level"}),(0,s.jsx)(e.th,{children:"Description"}),(0,s.jsx)(e.th,{children:"Capabilities"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"L1: Model"})}),(0,s.jsx)(e.td,{children:"Static 3D model"}),(0,s.jsx)(e.td,{children:"Visualization only"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"L2: Simulation"})}),(0,s.jsx)(e.td,{children:"Physics-based behavior"}),(0,s.jsx)(e.td,{children:"Algorithm testing"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"L3: Connected"})}),(0,s.jsx)(e.td,{children:"Receives real sensor data"}),(0,s.jsx)(e.td,{children:"Live monitoring"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"L4: Synchronized"})}),(0,s.jsx)(e.td,{children:"Bidirectional updates"}),(0,s.jsx)(e.td,{children:"Predictive maintenance"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"L5: Autonomous"})}),(0,s.jsx)(e.td,{children:"Self-updating models"}),(0,s.jsx)(e.td,{children:"Closed-loop optimization"})]})]})]}),"\n",(0,s.jsx)(e.admonition,{title:"Course Focus",type:"tip",children:(0,s.jsx)(e.p,{children:"This course focuses on L2-L3 digital twins. Higher levels require production infrastructure beyond our scope."})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"validation-workflow",children:"Validation Workflow"}),"\n",(0,s.jsx)(e.h3,{id:"the-validation-pipeline",children:"The Validation Pipeline"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Simulation Validation Pipeline                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                  \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502   \u2502  Define  \u2502    \u2502  Collect \u2502    \u2502  Run     \u2502    \u2502  Compare \u2502 \u2502\n\u2502   \u2502  Metrics \u2502\u2500\u2500\u2500\u25b6\u2502  Real    \u2502\u2500\u2500\u2500\u25b6\u2502  Sim     \u2502\u2500\u2500\u2500\u25b6\u2502  Results \u2502 \u2502\n\u2502   \u2502          \u2502    \u2502  Data    \u2502    \u2502  Tests   \u2502    \u2502          \u2502 \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502        \u2502                                               \u2502        \u2502\n\u2502        \u2502              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u2502        \u2502\n\u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25b6\u2502  Update  \u2502\u25c0\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502                       \u2502  Model   \u2502                              \u2502\n\u2502                       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2502\n\u2502                                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(e.h3,{id:"defining-validation-metrics",children:"Defining Validation Metrics"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",metastring:'title="validation_metrics.py"',children:'"""Define metrics for simulation validation."""\nimport numpy as np\nfrom dataclasses import dataclass\nfrom typing import List, Tuple\n\n@dataclass\nclass ValidationMetric:\n    """A metric for comparing simulation to reality."""\n    name: str\n    description: str\n    tolerance: float  # Acceptable error margin\n    unit: str\n\n# Common robotics validation metrics\nVALIDATION_METRICS = [\n    ValidationMetric(\n        name="position_error",\n        description="End-effector position accuracy",\n        tolerance=0.01,  # 1cm\n        unit="meters"\n    ),\n    ValidationMetric(\n        name="velocity_tracking",\n        description="Velocity command tracking error",\n        tolerance=0.05,  # 5%\n        unit="m/s"\n    ),\n    ValidationMetric(\n        name="sensor_latency",\n        description="Sensor data delay",\n        tolerance=0.010,  # 10ms\n        unit="seconds"\n    ),\n    ValidationMetric(\n        name="collision_detection",\n        description="Collision detection accuracy",\n        tolerance=0.02,  # 2cm\n        unit="meters"\n    ),\n]\n\ndef compute_metric(real_data: np.ndarray, sim_data: np.ndarray,\n                   metric: ValidationMetric) -> Tuple[float, bool]:\n    """\n    Compute error between real and simulated data.\n\n    Returns:\n        Tuple of (error_value, passes_tolerance)\n    """\n    if metric.name == "position_error":\n        error = np.mean(np.linalg.norm(real_data - sim_data, axis=1))\n    elif metric.name == "velocity_tracking":\n        error = np.mean(np.abs(real_data - sim_data) / (np.abs(real_data) + 1e-6))\n    else:\n        error = np.mean(np.abs(real_data - sim_data))\n\n    return error, error <= metric.tolerance\n'})}),"\n",(0,s.jsx)(e.h3,{id:"data-collection-protocol",children:"Data Collection Protocol"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",metastring:'title="data_collection.py"',children:"#!/usr/bin/env python3\n\"\"\"Collect synchronized data from real and simulated robots.\"\"\"\nimport rclpy\nfrom rclpy.node import Node\nfrom nav_msgs.msg import Odometry\nfrom sensor_msgs.msg import JointState\nimport json\nfrom datetime import datetime\n\nclass DataCollector(Node):\n    def __init__(self, source: str):  # 'real' or 'sim'\n        super().__init__(f'{source}_data_collector')\n        self.source = source\n        self.data = {\n            'source': source,\n            'timestamp': [],\n            'odom': [],\n            'joint_states': []\n        }\n\n        # Subscribe to robot data\n        self.odom_sub = self.create_subscription(\n            Odometry, '/odom', self.odom_callback, 10\n        )\n        self.joint_sub = self.create_subscription(\n            JointState, '/joint_states', self.joint_callback, 10\n        )\n\n        self.get_logger().info(f'Collecting {source} data...')\n\n    def odom_callback(self, msg: Odometry):\n        self.data['timestamp'].append(self.get_clock().now().nanoseconds)\n        self.data['odom'].append({\n            'x': msg.pose.pose.position.x,\n            'y': msg.pose.pose.position.y,\n            'theta': msg.pose.pose.orientation.z,\n            'vx': msg.twist.twist.linear.x,\n            'vtheta': msg.twist.twist.angular.z\n        })\n\n    def joint_callback(self, msg: JointState):\n        self.data['joint_states'].append({\n            'names': list(msg.name),\n            'positions': list(msg.position),\n            'velocities': list(msg.velocity)\n        })\n\n    def save_data(self, filename: str):\n        with open(filename, 'w') as f:\n            json.dump(self.data, f, indent=2)\n        self.get_logger().info(f'Saved to {filename}')\n\n\ndef main():\n    rclpy.init()\n    # Run for real robot:\n    # collector = DataCollector('real')\n    # Run for simulation:\n    collector = DataCollector('sim')\n    try:\n        rclpy.spin(collector)\n    except KeyboardInterrupt:\n        collector.save_data(f'data_{collector.source}_{datetime.now():%Y%m%d_%H%M%S}.json')\n    finally:\n        collector.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(e.h3,{id:"comparison-analysis",children:"Comparison Analysis"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",metastring:'title="validation_analysis.py"',children:"\"\"\"Compare real and simulated data.\"\"\"\nimport json\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom pathlib import Path\n\ndef load_and_align_data(real_file: str, sim_file: str):\n    \"\"\"Load data files and align by timestamp.\"\"\"\n    with open(real_file) as f:\n        real_data = json.load(f)\n    with open(sim_file) as f:\n        sim_data = json.load(f)\n\n    # Convert to numpy arrays\n    real_odom = np.array([[d['x'], d['y'], d['vx']] for d in real_data['odom']])\n    sim_odom = np.array([[d['x'], d['y'], d['vx']] for d in sim_data['odom']])\n\n    # Interpolate to common timestamps (simplified)\n    min_len = min(len(real_odom), len(sim_odom))\n    return real_odom[:min_len], sim_odom[:min_len]\n\ndef generate_validation_report(real_odom, sim_odom, output_dir: Path):\n    \"\"\"Generate validation report with plots and metrics.\"\"\"\n    output_dir.mkdir(exist_ok=True)\n\n    # Position tracking plot\n    fig, axes = plt.subplots(1, 3, figsize=(15, 4))\n\n    axes[0].plot(real_odom[:, 0], real_odom[:, 1], 'b-', label='Real')\n    axes[0].plot(sim_odom[:, 0], sim_odom[:, 1], 'r--', label='Sim')\n    axes[0].set_xlabel('X (m)')\n    axes[0].set_ylabel('Y (m)')\n    axes[0].set_title('Trajectory Comparison')\n    axes[0].legend()\n    axes[0].axis('equal')\n\n    # Position error over time\n    pos_error = np.sqrt((real_odom[:, 0] - sim_odom[:, 0])**2 +\n                        (real_odom[:, 1] - sim_odom[:, 1])**2)\n    axes[1].plot(pos_error)\n    axes[1].axhline(y=0.01, color='g', linestyle='--', label='Tolerance')\n    axes[1].set_xlabel('Time Step')\n    axes[1].set_ylabel('Position Error (m)')\n    axes[1].set_title('Position Error Over Time')\n    axes[1].legend()\n\n    # Velocity comparison\n    axes[2].plot(real_odom[:, 2], 'b-', label='Real Vx')\n    axes[2].plot(sim_odom[:, 2], 'r--', label='Sim Vx')\n    axes[2].set_xlabel('Time Step')\n    axes[2].set_ylabel('Velocity (m/s)')\n    axes[2].set_title('Velocity Tracking')\n    axes[2].legend()\n\n    plt.tight_layout()\n    plt.savefig(output_dir / 'validation_report.png', dpi=150)\n    plt.close()\n\n    # Compute summary metrics\n    metrics = {\n        'mean_position_error': float(np.mean(pos_error)),\n        'max_position_error': float(np.max(pos_error)),\n        'velocity_rmse': float(np.sqrt(np.mean((real_odom[:, 2] - sim_odom[:, 2])**2))),\n        'passed': np.mean(pos_error) < 0.01\n    }\n\n    with open(output_dir / 'metrics.json', 'w') as f:\n        json.dump(metrics, f, indent=2)\n\n    return metrics\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"cicd-with-simulation-in-the-loop",children:"CI/CD with Simulation-in-the-Loop"}),"\n",(0,s.jsx)(e.h3,{id:"pipeline-architecture",children:"Pipeline Architecture"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",metastring:'title=".github/workflows/simulation-test.yml"',children:"name: Simulation Tests\n\non:\n  push:\n    branches: [main, develop]\n  pull_request:\n    branches: [main]\n\njobs:\n  simulation-tests:\n    runs-on: ubuntu-22.04\n    container:\n      image: osrf/ros:humble-desktop\n\n    steps:\n      - uses: actions/checkout@v3\n\n      - name: Install dependencies\n        run: |\n          apt-get update\n          apt-get install -y ros-humble-ros-gz ros-humble-nav2-bringup\n          rosdep update\n          rosdep install --from-paths src -y --ignore-src\n\n      - name: Build workspace\n        run: |\n          source /opt/ros/humble/setup.bash\n          colcon build --packages-select my_robot_description my_robot_tests\n\n      - name: Run simulation tests\n        run: |\n          source /opt/ros/humble/setup.bash\n          source install/setup.bash\n          # Start Gazebo in headless mode\n          ros2 launch my_robot_description simulation.launch.py headless:=true &\n          sleep 10  # Wait for simulation to start\n          # Run test suite\n          ros2 launch my_robot_tests simulation_tests.launch.py\n        timeout-minutes: 30\n\n      - name: Upload test results\n        uses: actions/upload-artifact@v3\n        with:\n          name: test-results\n          path: |\n            test_results/\n            validation_reports/\n"})}),"\n",(0,s.jsx)(e.h3,{id:"test-scenarios",children:"Test Scenarios"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",metastring:'title="simulation_tests.py"',children:'#!/usr/bin/env python3\n"""Simulation test scenarios for CI/CD pipeline."""\nimport rclpy\nfrom rclpy.node import Node\nimport unittest\nfrom geometry_msgs.msg import Twist\nfrom nav_msgs.msg import Odometry\nimport time\n\nclass SimulationTestCase(unittest.TestCase):\n    """Base class for simulation tests."""\n\n    @classmethod\n    def setUpClass(cls):\n        rclpy.init()\n        cls.node = rclpy.create_node(\'simulation_tester\')\n        cls.cmd_pub = cls.node.create_publisher(Twist, \'/cmd_vel\', 10)\n        cls.latest_odom = None\n        cls.odom_sub = cls.node.create_subscription(\n            Odometry, \'/odom\', cls._odom_callback, 10\n        )\n\n    @classmethod\n    def _odom_callback(cls, msg):\n        cls.latest_odom = msg\n\n    def wait_for_odom(self, timeout=5.0):\n        """Wait for odometry message."""\n        start = time.time()\n        while self.latest_odom is None and time.time() - start < timeout:\n            rclpy.spin_once(self.node, timeout_sec=0.1)\n        self.assertIsNotNone(self.latest_odom, "No odometry received")\n\n    def send_velocity(self, linear: float, angular: float, duration: float):\n        """Send velocity command for specified duration."""\n        cmd = Twist()\n        cmd.linear.x = linear\n        cmd.angular.z = angular\n\n        start = time.time()\n        while time.time() - start < duration:\n            self.cmd_pub.publish(cmd)\n            rclpy.spin_once(self.node, timeout_sec=0.05)\n\n\nclass TestBasicMotion(SimulationTestCase):\n    """Test basic robot motion."""\n\n    def test_forward_motion(self):\n        """Robot should move forward when commanded."""\n        self.wait_for_odom()\n        initial_x = self.latest_odom.pose.pose.position.x\n\n        # Move forward for 2 seconds at 0.5 m/s\n        self.send_velocity(0.5, 0.0, 2.0)\n        self.wait_for_odom()\n\n        final_x = self.latest_odom.pose.pose.position.x\n        distance = final_x - initial_x\n\n        # Should move approximately 1 meter (0.5 m/s * 2s)\n        self.assertGreater(distance, 0.8, "Robot did not move forward enough")\n        self.assertLess(distance, 1.2, "Robot moved too far")\n\n    def test_rotation(self):\n        """Robot should rotate in place."""\n        self.wait_for_odom()\n\n        # Rotate for 3 seconds\n        self.send_velocity(0.0, 0.5, 3.0)\n        self.wait_for_odom()\n\n        # Check that robot rotated (simplified check)\n        # In production, compute actual rotation from quaternion\n        self.assertIsNotNone(self.latest_odom)\n\n    def test_stop(self):\n        """Robot should stop when commanded zero velocity."""\n        self.send_velocity(0.5, 0.0, 1.0)  # Move first\n        self.send_velocity(0.0, 0.0, 1.0)  # Stop\n\n        self.wait_for_odom()\n        vx = self.latest_odom.twist.twist.linear.x\n\n        self.assertLess(abs(vx), 0.05, "Robot did not stop")\n\n\nclass TestObstacleDetection(SimulationTestCase):\n    """Test obstacle detection capabilities."""\n\n    def test_lidar_range(self):\n        """LiDAR should detect obstacles within range."""\n        # This would subscribe to /scan and verify readings\n        pass\n\n    def test_collision_avoidance(self):\n        """Robot should stop before hitting obstacle."""\n        # This requires spawning obstacle and testing behavior\n        pass\n\n\nif __name__ == \'__main__\':\n    unittest.main()\n'})}),"\n",(0,s.jsx)(e.h3,{id:"automated-regression-testing",children:"Automated Regression Testing"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",metastring:'title="regression_suite.py"',children:"\"\"\"Regression test suite comparing simulation versions.\"\"\"\nimport subprocess\nimport json\nfrom pathlib import Path\nfrom datetime import datetime\n\ndef run_benchmark_suite(sim_version: str) -> dict:\n    \"\"\"Run standard benchmark and return metrics.\"\"\"\n    results = {\n        'version': sim_version,\n        'timestamp': datetime.now().isoformat(),\n        'tests': {}\n    }\n\n    # Test 1: Navigation benchmark\n    nav_result = subprocess.run([\n        'ros2', 'launch', 'my_robot_tests', 'nav_benchmark.launch.py',\n        f'sim_version:={sim_version}'\n    ], capture_output=True, timeout=300)\n    results['tests']['navigation'] = {\n        'passed': nav_result.returncode == 0,\n        'time_to_goal': parse_nav_time(nav_result.stdout)\n    }\n\n    # Test 2: Manipulation benchmark\n    manip_result = subprocess.run([\n        'ros2', 'launch', 'my_robot_tests', 'manipulation_benchmark.launch.py',\n        f'sim_version:={sim_version}'\n    ], capture_output=True, timeout=300)\n    results['tests']['manipulation'] = {\n        'passed': manip_result.returncode == 0,\n        'success_rate': parse_success_rate(manip_result.stdout)\n    }\n\n    return results\n\ndef compare_versions(baseline: dict, current: dict) -> dict:\n    \"\"\"Compare benchmark results between versions.\"\"\"\n    comparison = {\n        'baseline_version': baseline['version'],\n        'current_version': current['version'],\n        'regressions': [],\n        'improvements': []\n    }\n\n    for test_name in baseline['tests']:\n        base_val = baseline['tests'][test_name]\n        curr_val = current['tests'][test_name]\n\n        if not curr_val['passed'] and base_val['passed']:\n            comparison['regressions'].append(f\"{test_name}: Now failing\")\n        elif curr_val['passed'] and not base_val['passed']:\n            comparison['improvements'].append(f\"{test_name}: Now passing\")\n\n    return comparison\n"})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"asset-management",children:"Asset Management"}),"\n",(0,s.jsx)(e.h3,{id:"directory-structure",children:"Directory Structure"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"my_robot_simulation/\n\u251c\u2500\u2500 worlds/\n\u2502   \u251c\u2500\u2500 warehouse.sdf\n\u2502   \u251c\u2500\u2500 outdoor.sdf\n\u2502   \u2514\u2500\u2500 test_arena.sdf\n\u251c\u2500\u2500 models/\n\u2502   \u251c\u2500\u2500 my_robot/\n\u2502   \u2502   \u251c\u2500\u2500 model.config\n\u2502   \u2502   \u251c\u2500\u2500 model.sdf\n\u2502   \u2502   \u2514\u2500\u2500 meshes/\n\u2502   \u2502       \u251c\u2500\u2500 base_link.stl\n\u2502   \u2502       \u2514\u2500\u2500 wheel.stl\n\u2502   \u2514\u2500\u2500 obstacles/\n\u2502       \u251c\u2500\u2500 box_small/\n\u2502       \u2514\u2500\u2500 cylinder_tall/\n\u251c\u2500\u2500 config/\n\u2502   \u251c\u2500\u2500 bridge.yaml\n\u2502   \u251c\u2500\u2500 sensors.yaml\n\u2502   \u2514\u2500\u2500 physics.yaml\n\u251c\u2500\u2500 launch/\n\u2502   \u251c\u2500\u2500 simulation.launch.py\n\u2502   \u2514\u2500\u2500 test_world.launch.py\n\u251c\u2500\u2500 urdf/\n\u2502   \u251c\u2500\u2500 robot.urdf.xacro\n\u2502   \u2514\u2500\u2500 sensors.xacro\n\u2514\u2500\u2500 tests/\n    \u251c\u2500\u2500 simulation_tests.py\n    \u2514\u2500\u2500 validation/\n        \u251c\u2500\u2500 real_data/\n        \u2514\u2500\u2500 comparison_scripts/\n"})}),"\n",(0,s.jsx)(e.h3,{id:"version-control-best-practices",children:"Version Control Best Practices"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-gitignore",metastring:'title=".gitignore"',children:"# Gazebo cache\n~/.gazebo/\n\n# Build artifacts\nbuild/\ninstall/\nlog/\n\n# Large binary files (use Git LFS)\n*.dae\n*.stl\n*.obj\n\n# Simulation logs\n*.log\ngazebo-*.log\n\n# Test artifacts\ntest_results/\nvalidation_reports/\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-bash",metastring:'title="Git LFS setup for meshes"',children:'# Install Git LFS\nsudo apt install git-lfs\ngit lfs install\n\n# Track mesh files\ngit lfs track "*.stl"\ngit lfs track "*.dae"\ngit lfs track "*.obj"\n\n# Track large world files\ngit lfs track "*.world"\ngit lfs track "worlds/*.sdf"\n\n# Add .gitattributes\ngit add .gitattributes\ngit commit -m "Configure Git LFS for simulation assets"\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"scaling-simulations",children:"Scaling Simulations"}),"\n",(0,s.jsx)(e.h3,{id:"parallel-simulation-for-training",children:"Parallel Simulation for Training"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",metastring:'title="parallel_simulation.py"',children:"\"\"\"Launch multiple simulation instances for parallel training.\"\"\"\nimport subprocess\nimport os\nfrom multiprocessing import Pool\nfrom typing import List, Tuple\n\ndef launch_simulation(config: Tuple[int, dict]) -> dict:\n    \"\"\"Launch a single simulation instance.\"\"\"\n    instance_id, params = config\n\n    # Set unique ROS domain ID\n    env = os.environ.copy()\n    env['ROS_DOMAIN_ID'] = str(100 + instance_id)\n\n    # Launch simulation with unique port\n    gz_port = 11345 + instance_id\n\n    cmd = [\n        'gz', 'sim', '-s',  # Server only, no GUI\n        '-r', params['world_file'],\n        '--physics-engine', params.get('physics_engine', 'ode'),\n    ]\n\n    proc = subprocess.Popen(\n        cmd,\n        env=env,\n        stdout=subprocess.PIPE,\n        stderr=subprocess.PIPE\n    )\n\n    return {\n        'instance_id': instance_id,\n        'pid': proc.pid,\n        'ros_domain_id': env['ROS_DOMAIN_ID'],\n        'gz_port': gz_port\n    }\n\n\ndef launch_parallel_simulations(num_instances: int, world_file: str) -> List[dict]:\n    \"\"\"Launch multiple simulation instances in parallel.\"\"\"\n    configs = [\n        (i, {'world_file': world_file})\n        for i in range(num_instances)\n    ]\n\n    with Pool(num_instances) as pool:\n        results = pool.map(launch_simulation, configs)\n\n    return results\n\n\n# Usage for RL training\nif __name__ == '__main__':\n    # Launch 8 parallel simulations for training\n    instances = launch_parallel_simulations(8, 'training_world.sdf')\n    print(f\"Launched {len(instances)} simulation instances\")\n"})}),"\n",(0,s.jsx)(e.h3,{id:"cloud-based-simulation",children:"Cloud-Based Simulation"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",metastring:'title="kubernetes/simulation-deployment.yaml"',children:'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: gazebo-simulation\nspec:\n  replicas: 10  # 10 parallel simulations\n  selector:\n    matchLabels:\n      app: gazebo-sim\n  template:\n    metadata:\n      labels:\n        app: gazebo-sim\n    spec:\n      containers:\n      - name: gazebo\n        image: osrf/ros:humble-simulation\n        command: ["ros2", "launch", "my_robot", "simulation.launch.py", "headless:=true"]\n        resources:\n          requests:\n            memory: "4Gi"\n            cpu: "2"\n          limits:\n            memory: "8Gi"\n            cpu: "4"\n        env:\n        - name: ROS_DOMAIN_ID\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n'})}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"exercise-1-validation-pipeline",children:"Exercise 1: Validation Pipeline"}),"\n",(0,s.jsxs)(e.admonition,{title:"Exercise 1: Build a Validation Pipeline",type:"tip",children:[(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Objective"}),": Create a validation pipeline comparing simulation to real data."]}),(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Time Estimate"}),": 60 minutes"]}),(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Steps"}),":"]}),(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"Define 3 validation metrics for your robot"}),"\n",(0,s.jsx)(e.li,{children:"Collect 60 seconds of data from simulation"}),"\n",(0,s.jsx)(e.li,{children:'Create synthetic "real" data with added noise'}),"\n",(0,s.jsx)(e.li,{children:"Implement comparison functions"}),"\n",(0,s.jsx)(e.li,{children:"Generate a validation report with plots"}),"\n"]}),(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Expected Output"}),":"]}),(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"metrics.json"})," with pass/fail status"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"validation_report.png"})," with comparison plots"]}),"\n",(0,s.jsx)(e.li,{children:"Summary of which metrics passed tolerance"}),"\n"]}),(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Success Criteria"}),":"]}),(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Position error < 1cm for 90% of time steps"}),"\n",(0,s.jsx)(e.li,{children:"Velocity tracking error < 5%"}),"\n"]})]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"exercise-2-cicd-integration",children:"Exercise 2: CI/CD Integration"}),"\n",(0,s.jsxs)(e.admonition,{title:"Exercise 2: Simulation-in-the-Loop CI",type:"tip",children:[(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Objective"}),": Set up automated testing with simulation in a CI pipeline."]}),(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Time Estimate"}),": 45 minutes"]}),(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Steps"}),":"]}),(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"Create a GitHub Actions workflow file"}),"\n",(0,s.jsx)(e.li,{children:"Add simulation launch step (headless mode)"}),"\n",(0,s.jsx)(e.li,{children:"Create 3 test cases (motion, stopping, rotation)"}),"\n",(0,s.jsx)(e.li,{children:"Configure test result artifacts"}),"\n",(0,s.jsx)(e.li,{children:"Set up pass/fail criteria"}),"\n"]}),(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Test Coverage"}),":"]}),(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Basic motion commands"}),"\n",(0,s.jsx)(e.li,{children:"Emergency stop response"}),"\n",(0,s.jsx)(e.li,{children:"Sensor data publication"}),"\n"]}),(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Expected Result"}),": PR checks run simulation tests automatically."]})]}),"\n",(0,s.jsx)(e.hr,{}),"\n",(0,s.jsx)(e.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(e.p,{children:"In this chapter, you learned:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Digital Twin Lifecycle"}),": From static models to synchronized systems"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Validation"}),": Define metrics, collect data, compare real vs. sim"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"CI/CD Integration"}),": Automated testing with simulation-in-the-loop"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Asset Management"}),": Version control for simulation files"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Scaling"}),": Parallel simulations for training and cloud deployment"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"These workflows transform simulations from development tools into production infrastructure. Combined with the Gazebo and Unity skills from earlier chapters, you're now equipped to build robust robotics development pipelines."}),"\n",(0,s.jsx)(e.h2,{id:"module-2-completion",children:"Module 2 Completion"}),"\n",(0,s.jsx)(e.p,{children:"Congratulations on completing Module 2! You've learned:"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"Simulation fundamentals and physics engines"}),"\n",(0,s.jsx)(e.li,{children:"Gazebo world and robot creation"}),"\n",(0,s.jsx)(e.li,{children:"ROS 2 bridge integration"}),"\n",(0,s.jsx)(e.li,{children:"Unity for perception and synthetic data"}),"\n",(0,s.jsx)(e.li,{children:"Digital twin best practices"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["Continue to ",(0,s.jsx)(e.a,{href:"/docs/module-3",children:"Module 3: NVIDIA Isaac Platform"})," to explore advanced simulation with GPU acceleration and reinforcement learning."]}),"\n",(0,s.jsx)(e.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://www.digitaltwinconsortium.org/",children:"Digital Twin Consortium"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://arxiv.org/abs/2003.07739",children:"Simulation-Based Testing for Autonomous Vehicles"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/ros-tooling/setup-ros",children:"GitHub Actions for ROS 2"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://www.robolaunch.io/",children:"Kubernetes for Robotics"})}),"\n"]})]})}function m(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(c,{...n})}):c(n)}}}]);