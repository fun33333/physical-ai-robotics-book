"use strict";(globalThis.webpackChunkbook_website=globalThis.webpackChunkbook_website||[]).push([[5146],{8453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>a});var r=i(6540);const s={},o=r.createContext(s);function t(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),r.createElement(o.Provider,{value:n},e.children)}},9866:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>m,frontMatter:()=>t,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"module-2/gazebo-ros2-integration","title":"Gazebo-ROS 2 Integration","description":"Connecting Gazebo simulations to ROS 2: bridges, plugins, and seamless hardware abstraction.","source":"@site/docs/module-2/gazebo-ros2-integration.md","sourceDirName":"module-2","slug":"/module-2/gazebo-ros2-integration","permalink":"/physical-ai-robotics-book/docs/module-2/gazebo-ros2-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/fun33333/physical-ai-robotics-book/tree/main/book-website/docs/module-2/gazebo-ros2-integration.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Gazebo-ROS 2 Integration","sidebar_position":4,"description":"Connecting Gazebo simulations to ROS 2: bridges, plugins, and seamless hardware abstraction."},"sidebar":"tutorialSidebar","previous":{"title":"Gazebo Basics","permalink":"/physical-ai-robotics-book/docs/module-2/gazebo-basics"},"next":{"title":"Unity for Robotics","permalink":"/physical-ai-robotics-book/docs/module-2/unity-robotics"}}');var s=i(4848),o=i(8453);const t={title:"Gazebo-ROS 2 Integration",sidebar_position:4,description:"Connecting Gazebo simulations to ROS 2: bridges, plugins, and seamless hardware abstraction."},a="Gazebo-ROS 2 Integration",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"The ros_gz Bridge",id:"the-ros_gz-bridge",level:2},{value:"Architecture",id:"architecture",level:3},{value:"Bridge Directions",id:"bridge-directions",level:3},{value:"Installing the Bridge",id:"installing-the-bridge",level:2},{value:"Configuring Topic Bridges",id:"configuring-topic-bridges",level:2},{value:"YAML Configuration",id:"yaml-configuration",level:3},{value:"Running the Bridge",id:"running-the-bridge",level:3},{value:"ROS 2 Launch Files",id:"ros-2-launch-files",level:2},{value:"Complete Simulation Launch",id:"complete-simulation-launch",level:3},{value:"Launch Commands",id:"launch-commands",level:3},{value:"Sensor Integration",id:"sensor-integration",level:2},{value:"Camera with Image Bridge",id:"camera-with-image-bridge",level:3},{value:"LiDAR with LaserScan Bridge",id:"lidar-with-laserscan-bridge",level:3},{value:"Control Integration",id:"control-integration",level:2},{value:"Differential Drive Controller",id:"differential-drive-controller",level:3},{value:"Bridge for Control Topics",id:"bridge-for-control-topics",level:3},{value:"Hardware Abstraction Pattern",id:"hardware-abstraction-pattern",level:2},{value:"The Key Principle",id:"the-key-principle",level:3},{value:"Launch File Abstraction",id:"launch-file-abstraction",level:3},{value:"Debugging Integration Issues",id:"debugging-integration-issues",level:2},{value:"Common Problems and Solutions",id:"common-problems-and-solutions",level:3},{value:"Debugging Commands",id:"debugging-commands",level:3},{value:"Visualization in RViz2",id:"visualization-in-rviz2",level:3},{value:"Exercise 1: Complete Sensor Bridge",id:"exercise-1-complete-sensor-bridge",level:2},{value:"Exercise 2: Teleoperation Setup",id:"exercise-2-teleoperation-setup",level:2},{value:"Exercise 3: RViz2 Visualization",id:"exercise-3-rviz2-visualization",level:2},{value:"Summary",id:"summary",level:2},{value:"Further Reading",id:"further-reading",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"gazebo-ros-2-integration",children:"Gazebo-ROS 2 Integration"})}),"\n",(0,s.jsx)(n.p,{children:"The power of Gazebo for robotics development comes from its seamless integration with ROS 2. This chapter teaches you to bridge your simulations to the ROS 2 ecosystem, enabling the same code to run on simulated and real robots."}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"In this section, you will:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Understand the ros_gz bridge architecture and message mapping"}),"\n",(0,s.jsx)(n.li,{children:"Configure bidirectional topic bridges for sensors and commands"}),"\n",(0,s.jsx)(n.li,{children:"Set up ROS 2 launch files for simulation"}),"\n",(0,s.jsx)(n.li,{children:"Use Gazebo plugins with ROS 2 interfaces"}),"\n",(0,s.jsx)(n.li,{children:"Implement hardware abstraction for sim/real portability"}),"\n",(0,s.jsx)(n.li,{children:"Debug common integration issues"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(n.p,{children:"Before starting, ensure you have:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/module-2/gazebo-basics",children:"Gazebo Basics"})," completed"]}),"\n",(0,s.jsx)(n.li,{children:"Gazebo Harmonic and ros-humble-ros-gz installed"}),"\n",(0,s.jsx)(n.li,{children:"A working robot URDF with sensors"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"the-ros_gz-bridge",children:"The ros_gz Bridge"}),"\n",(0,s.jsx)(n.h3,{id:"architecture",children:"Architecture"}),"\n",(0,s.jsx)(n.p,{children:"The ros_gz bridge translates messages between Gazebo Transport and ROS 2:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    ros_gz Bridge Architecture                     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                  \u2502\n\u2502   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502   \u2502    Gazebo Sim    \u2502              \u2502      ROS 2       \u2502        \u2502\n\u2502   \u2502   (gz Transport) \u2502              \u2502   (DDS/rmw)      \u2502        \u2502\n\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502            \u2502                                  \u2502                  \u2502\n\u2502            \u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502                  \u2502\n\u2502            \u2514\u2500\u2500\u2500\u25ba\u2502   ros_gz_bridge    \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2518                  \u2502\n\u2502                 \u2502                    \u2502                          \u2502\n\u2502                 \u2502  \u2022 Message convert \u2502                          \u2502\n\u2502                 \u2502  \u2022 Topic mapping   \u2502                          \u2502\n\u2502                 \u2502  \u2022 QoS handling    \u2502                          \u2502\n\u2502                 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                          \u2502\n\u2502                                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(n.h3,{id:"bridge-directions",children:"Bridge Directions"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Direction"}),(0,s.jsx)(n.th,{children:"Use Case"}),(0,s.jsx)(n.th,{children:"Example"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"GZ_TO_ROS"})}),(0,s.jsx)(n.td,{children:"Sensor data to ROS 2"}),(0,s.jsx)(n.td,{children:"Camera images, LiDAR scans"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ROS_TO_GZ"})}),(0,s.jsx)(n.td,{children:"Commands to Gazebo"}),(0,s.jsx)(n.td,{children:"Velocity commands, joint positions"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"BIDIRECTIONAL"})}),(0,s.jsx)(n.td,{children:"Two-way communication"}),(0,s.jsx)(n.td,{children:"Clock synchronization"})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"installing-the-bridge",children:"Installing the Bridge"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="Install ros_gz packages"',children:"# Core bridge packages\nsudo apt install ros-humble-ros-gz-bridge\nsudo apt install ros-humble-ros-gz-sim\nsudo apt install ros-humble-ros-gz-image\n\n# Additional utilities\nsudo apt install ros-humble-ros-gz-interfaces\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"configuring-topic-bridges",children:"Configuring Topic Bridges"}),"\n",(0,s.jsx)(n.h3,{id:"yaml-configuration",children:"YAML Configuration"}),"\n",(0,s.jsx)(n.p,{children:"Create a bridge configuration file:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="bridge_config.yaml"',children:'# Sensor bridges (Gazebo to ROS 2)\n- ros_topic_name: "/camera/image_raw"\n  gz_topic_name: "/world/default/model/robot/link/camera_link/sensor/camera/image"\n  ros_type_name: "sensor_msgs/msg/Image"\n  gz_type_name: "gz.msgs.Image"\n  direction: GZ_TO_ROS\n\n- ros_topic_name: "/camera/camera_info"\n  gz_topic_name: "/world/default/model/robot/link/camera_link/sensor/camera/camera_info"\n  ros_type_name: "sensor_msgs/msg/CameraInfo"\n  gz_type_name: "gz.msgs.CameraInfo"\n  direction: GZ_TO_ROS\n\n- ros_topic_name: "/scan"\n  gz_topic_name: "/world/default/model/robot/link/lidar_link/sensor/lidar/scan"\n  ros_type_name: "sensor_msgs/msg/LaserScan"\n  gz_type_name: "gz.msgs.LaserScan"\n  direction: GZ_TO_ROS\n\n- ros_topic_name: "/imu"\n  gz_topic_name: "/world/default/model/robot/link/base_link/sensor/imu/imu"\n  ros_type_name: "sensor_msgs/msg/Imu"\n  gz_type_name: "gz.msgs.IMU"\n  direction: GZ_TO_ROS\n\n# Command bridges (ROS 2 to Gazebo)\n- ros_topic_name: "/cmd_vel"\n  gz_topic_name: "/model/robot/cmd_vel"\n  ros_type_name: "geometry_msgs/msg/Twist"\n  gz_type_name: "gz.msgs.Twist"\n  direction: ROS_TO_GZ\n\n# Clock synchronization (bidirectional)\n- ros_topic_name: "/clock"\n  gz_topic_name: "/clock"\n  ros_type_name: "rosgraph_msgs/msg/Clock"\n  gz_type_name: "gz.msgs.Clock"\n  direction: GZ_TO_ROS\n'})}),"\n",(0,s.jsx)(n.h3,{id:"running-the-bridge",children:"Running the Bridge"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="Launch bridge with config"',children:"# Using configuration file\nros2 run ros_gz_bridge parameter_bridge --ros-args -p config_file:=bridge_config.yaml\n\n# Quick bridge for single topic\nros2 run ros_gz_bridge parameter_bridge /cmd_vel@geometry_msgs/msg/Twist]gz.msgs.Twist\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"ros-2-launch-files",children:"ROS 2 Launch Files"}),"\n",(0,s.jsx)(n.h3,{id:"complete-simulation-launch",children:"Complete Simulation Launch"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",metastring:'title="simulation.launch.py"',children:"import os\nfrom ament_index_python.packages import get_package_share_directory\nfrom launch import LaunchDescription\nfrom launch.actions import IncludeLaunchDescription, DeclareLaunchArgument\nfrom launch.launch_description_sources import PythonLaunchDescriptionSource\nfrom launch.substitutions import LaunchConfiguration, PathJoinSubstitution\nfrom launch_ros.actions import Node\n\ndef generate_launch_description():\n    # Package directories\n    pkg_ros_gz_sim = get_package_share_directory('ros_gz_sim')\n    pkg_my_robot = get_package_share_directory('my_robot_description')\n\n    # Launch arguments\n    world_file = LaunchConfiguration('world')\n    use_sim_time = LaunchConfiguration('use_sim_time', default='true')\n\n    # Declare arguments\n    declare_world_arg = DeclareLaunchArgument(\n        'world',\n        default_value=PathJoinSubstitution([pkg_my_robot, 'worlds', 'warehouse.sdf']),\n        description='Path to world file'\n    )\n\n    # Start Gazebo\n    gazebo = IncludeLaunchDescription(\n        PythonLaunchDescriptionSource([\n            os.path.join(pkg_ros_gz_sim, 'launch', 'gz_sim.launch.py')\n        ]),\n        launch_arguments={\n            'gz_args': ['-r ', world_file],\n        }.items()\n    )\n\n    # Spawn robot from URDF\n    spawn_robot = Node(\n        package='ros_gz_sim',\n        executable='create',\n        arguments=[\n            '-name', 'my_robot',\n            '-topic', 'robot_description',\n            '-x', '0.0',\n            '-y', '0.0',\n            '-z', '0.5',\n        ],\n        output='screen',\n    )\n\n    # Robot state publisher\n    robot_state_publisher = Node(\n        package='robot_state_publisher',\n        executable='robot_state_publisher',\n        parameters=[{\n            'robot_description': open(\n                os.path.join(pkg_my_robot, 'urdf', 'robot.urdf')\n            ).read(),\n            'use_sim_time': use_sim_time,\n        }],\n        output='screen',\n    )\n\n    # Bridge configuration\n    bridge = Node(\n        package='ros_gz_bridge',\n        executable='parameter_bridge',\n        parameters=[{\n            'config_file': os.path.join(pkg_my_robot, 'config', 'bridge.yaml'),\n            'use_sim_time': use_sim_time,\n        }],\n        output='screen',\n    )\n\n    # RViz2 for visualization\n    rviz = Node(\n        package='rviz2',\n        executable='rviz2',\n        arguments=['-d', os.path.join(pkg_my_robot, 'rviz', 'simulation.rviz')],\n        parameters=[{'use_sim_time': use_sim_time}],\n        output='screen',\n    )\n\n    return LaunchDescription([\n        declare_world_arg,\n        gazebo,\n        spawn_robot,\n        robot_state_publisher,\n        bridge,\n        rviz,\n    ])\n"})}),"\n",(0,s.jsx)(n.h3,{id:"launch-commands",children:"Launch Commands"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="Running the simulation"',children:"# Build your package first\ncolcon build --packages-select my_robot_description\n\n# Source the workspace\nsource install/setup.bash\n\n# Launch simulation\nros2 launch my_robot_description simulation.launch.py\n\n# Launch with custom world\nros2 launch my_robot_description simulation.launch.py world:=/path/to/custom.sdf\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"sensor-integration",children:"Sensor Integration"}),"\n",(0,s.jsx)(n.h3,{id:"camera-with-image-bridge",children:"Camera with Image Bridge"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",metastring:'title="camera_gazebo.urdf.xacro"',children:'<?xml version="1.0"?>\n<robot xmlns:xacro="http://www.ros.org/wiki/xacro">\n  <xacro:macro name="camera_sensor" params="parent_link">\n    <link name="camera_link">\n      <visual>\n        <geometry>\n          <box size="0.02 0.05 0.02"/>\n        </geometry>\n      </visual>\n      <collision>\n        <geometry>\n          <box size="0.02 0.05 0.02"/>\n        </geometry>\n      </collision>\n      <inertial>\n        <mass value="0.01"/>\n        <inertia ixx="1e-6" ixy="0" ixz="0" iyy="1e-6" iyz="0" izz="1e-6"/>\n      </inertial>\n    </link>\n\n    <joint name="camera_joint" type="fixed">\n      <parent link="${parent_link}"/>\n      <child link="camera_link"/>\n      <origin xyz="0.2 0 0.1" rpy="0 0 0"/>\n    </joint>\n\n    \x3c!-- Gazebo sensor configuration --\x3e\n    <gazebo reference="camera_link">\n      <sensor name="camera" type="camera">\n        <always_on>true</always_on>\n        <update_rate>30</update_rate>\n        <visualize>true</visualize>\n        <camera>\n          <horizontal_fov>1.047</horizontal_fov>\n          <image>\n            <width>640</width>\n            <height>480</height>\n            <format>R8G8B8</format>\n          </image>\n          <clip>\n            <near>0.1</near>\n            <far>100</far>\n          </clip>\n          <noise>\n            <type>gaussian</type>\n            <mean>0.0</mean>\n            <stddev>0.007</stddev>\n          </noise>\n        </camera>\n        \x3c!-- Topic will be: /world/{world}/model/{model}/link/camera_link/sensor/camera/image --\x3e\n      </sensor>\n    </gazebo>\n  </xacro:macro>\n</robot>\n'})}),"\n",(0,s.jsx)(n.h3,{id:"lidar-with-laserscan-bridge",children:"LiDAR with LaserScan Bridge"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",metastring:'title="lidar_gazebo.urdf.xacro"',children:'<?xml version="1.0"?>\n<robot xmlns:xacro="http://www.ros.org/wiki/xacro">\n  <xacro:macro name="lidar_sensor" params="parent_link">\n    <link name="lidar_link">\n      <visual>\n        <geometry>\n          <cylinder radius="0.05" length="0.04"/>\n        </geometry>\n        <material name="dark_grey">\n          <color rgba="0.2 0.2 0.2 1"/>\n        </material>\n      </visual>\n      <collision>\n        <geometry>\n          <cylinder radius="0.05" length="0.04"/>\n        </geometry>\n      </collision>\n      <inertial>\n        <mass value="0.2"/>\n        <inertia ixx="1e-4" ixy="0" ixz="0" iyy="1e-4" iyz="0" izz="1e-4"/>\n      </inertial>\n    </link>\n\n    <joint name="lidar_joint" type="fixed">\n      <parent link="${parent_link}"/>\n      <child link="lidar_link"/>\n      <origin xyz="0 0 0.15" rpy="0 0 0"/>\n    </joint>\n\n    <gazebo reference="lidar_link">\n      <sensor name="lidar" type="gpu_lidar">\n        <always_on>true</always_on>\n        <update_rate>10</update_rate>\n        <visualize>true</visualize>\n        <lidar>\n          <scan>\n            <horizontal>\n              <samples>360</samples>\n              <resolution>1.0</resolution>\n              <min_angle>-3.14159</min_angle>\n              <max_angle>3.14159</max_angle>\n            </horizontal>\n            <vertical>\n              <samples>1</samples>\n              <resolution>1</resolution>\n              <min_angle>0</min_angle>\n              <max_angle>0</max_angle>\n            </vertical>\n          </scan>\n          <range>\n            <min>0.1</min>\n            <max>30.0</max>\n            <resolution>0.01</resolution>\n          </range>\n          <noise>\n            <type>gaussian</type>\n            <mean>0.0</mean>\n            <stddev>0.02</stddev>\n          </noise>\n        </lidar>\n      </sensor>\n    </gazebo>\n  </xacro:macro>\n</robot>\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"control-integration",children:"Control Integration"}),"\n",(0,s.jsx)(n.h3,{id:"differential-drive-controller",children:"Differential Drive Controller"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",metastring:'title="Adding diff_drive to URDF for ROS 2"',children:'<gazebo>\n  \x3c!-- Differential drive plugin --\x3e\n  <plugin filename="gz-sim-diff-drive-system"\n          name="gz::sim::systems::DiffDrive">\n    <left_joint>left_wheel_joint</left_joint>\n    <right_joint>right_wheel_joint</right_joint>\n    <wheel_separation>0.35</wheel_separation>\n    <wheel_radius>0.1</wheel_radius>\n    <max_linear_acceleration>1.0</max_linear_acceleration>\n    <max_angular_acceleration>2.0</max_angular_acceleration>\n    <odom_publish_frequency>50</odom_publish_frequency>\n\n    \x3c!-- Topic names (Gazebo side) --\x3e\n    <topic>cmd_vel</topic>\n    <odom_topic>odom</odom_topic>\n    <tf_topic>tf</tf_topic>\n\n    \x3c!-- Frame IDs --\x3e\n    <frame_id>odom</frame_id>\n    <child_frame_id>base_link</child_frame_id>\n  </plugin>\n\n  \x3c!-- Joint state publisher --\x3e\n  <plugin filename="gz-sim-joint-state-publisher-system"\n          name="gz::sim::systems::JointStatePublisher">\n    <joint_name>left_wheel_joint</joint_name>\n    <joint_name>right_wheel_joint</joint_name>\n  </plugin>\n</gazebo>\n'})}),"\n",(0,s.jsx)(n.h3,{id:"bridge-for-control-topics",children:"Bridge for Control Topics"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="control_bridge.yaml"',children:'# Velocity commands\n- ros_topic_name: "/cmd_vel"\n  gz_topic_name: "/model/my_robot/cmd_vel"\n  ros_type_name: "geometry_msgs/msg/Twist"\n  gz_type_name: "gz.msgs.Twist"\n  direction: ROS_TO_GZ\n\n# Odometry\n- ros_topic_name: "/odom"\n  gz_topic_name: "/model/my_robot/odom"\n  ros_type_name: "nav_msgs/msg/Odometry"\n  gz_type_name: "gz.msgs.Odometry"\n  direction: GZ_TO_ROS\n\n# Joint states\n- ros_topic_name: "/joint_states"\n  gz_topic_name: "/world/default/model/my_robot/joint_state"\n  ros_type_name: "sensor_msgs/msg/JointState"\n  gz_type_name: "gz.msgs.Model"\n  direction: GZ_TO_ROS\n\n# TF (transforms)\n- ros_topic_name: "/tf"\n  gz_topic_name: "/model/my_robot/tf"\n  ros_type_name: "tf2_msgs/msg/TFMessage"\n  gz_type_name: "gz.msgs.Pose_V"\n  direction: GZ_TO_ROS\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"hardware-abstraction-pattern",children:"Hardware Abstraction Pattern"}),"\n",(0,s.jsx)(n.h3,{id:"the-key-principle",children:"The Key Principle"}),"\n",(0,s.jsx)(n.p,{children:"Write your ROS 2 nodes to be simulation-agnostic:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",metastring:'title="robot_controller.py"',children:"#!/usr/bin/env python3\n\"\"\"\nRobot controller that works identically in simulation and on real hardware.\nThe only difference is the underlying data source (Gazebo bridge vs real drivers).\n\"\"\"\nimport rclpy\nfrom rclpy.node import Node\nfrom geometry_msgs.msg import Twist\nfrom sensor_msgs.msg import LaserScan\nfrom nav_msgs.msg import Odometry\n\nclass RobotController(Node):\n    def __init__(self):\n        super().__init__('robot_controller')\n\n        # Parameters\n        self.declare_parameter('use_sim_time', False)\n        self.declare_parameter('max_linear_speed', 0.5)\n        self.declare_parameter('max_angular_speed', 1.0)\n\n        # Publishers - same topic names for sim and real\n        self.cmd_pub = self.create_publisher(Twist, '/cmd_vel', 10)\n\n        # Subscribers - same topic names for sim and real\n        self.scan_sub = self.create_subscription(\n            LaserScan, '/scan', self.scan_callback, 10\n        )\n        self.odom_sub = self.create_subscription(\n            Odometry, '/odom', self.odom_callback, 10\n        )\n\n        # Control loop\n        self.timer = self.create_timer(0.1, self.control_loop)\n\n        self.latest_scan = None\n        self.latest_odom = None\n\n        self.get_logger().info('Robot controller initialized')\n\n    def scan_callback(self, msg: LaserScan):\n        self.latest_scan = msg\n\n    def odom_callback(self, msg: Odometry):\n        self.latest_odom = msg\n\n    def control_loop(self):\n        \"\"\"Main control logic - works in sim or real.\"\"\"\n        if self.latest_scan is None:\n            return\n\n        cmd = Twist()\n        max_linear = self.get_parameter('max_linear_speed').value\n        max_angular = self.get_parameter('max_angular_speed').value\n\n        # Simple obstacle avoidance\n        min_distance = min(self.latest_scan.ranges)\n\n        if min_distance < 0.5:\n            # Obstacle close - turn\n            cmd.linear.x = 0.0\n            cmd.angular.z = max_angular\n        else:\n            # Clear path - go forward\n            cmd.linear.x = max_linear\n            cmd.angular.z = 0.0\n\n        self.cmd_pub.publish(cmd)\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    controller = RobotController()\n    rclpy.spin(controller)\n    controller.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"launch-file-abstraction",children:"Launch File Abstraction"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",metastring:'title="robot.launch.py"',children:"\"\"\"\nLaunch file that can start simulation or real robot based on parameters.\n\"\"\"\nfrom launch import LaunchDescription\nfrom launch.actions import DeclareLaunchArgument, GroupAction\nfrom launch.conditions import IfCondition, UnlessCondition\nfrom launch.substitutions import LaunchConfiguration\nfrom launch_ros.actions import Node\n\ndef generate_launch_description():\n    # Declare simulation argument\n    use_sim = LaunchConfiguration('use_sim', default='true')\n\n    declare_use_sim = DeclareLaunchArgument(\n        'use_sim',\n        default_value='true',\n        description='Use simulation (true) or real robot (false)'\n    )\n\n    # Common nodes (run in both sim and real)\n    common_nodes = GroupAction([\n        Node(\n            package='my_robot_control',\n            executable='robot_controller',\n            parameters=[{\n                'use_sim_time': use_sim,\n            }],\n            output='screen',\n        ),\n    ])\n\n    # Simulation-only nodes\n    sim_nodes = GroupAction(\n        condition=IfCondition(use_sim),\n        actions=[\n            # Gazebo and bridge launched separately or included here\n        ]\n    )\n\n    # Real robot nodes\n    real_nodes = GroupAction(\n        condition=UnlessCondition(use_sim),\n        actions=[\n            Node(\n                package='my_robot_driver',\n                executable='motor_driver',\n                output='screen',\n            ),\n            Node(\n                package='my_robot_driver',\n                executable='sensor_driver',\n                output='screen',\n            ),\n        ]\n    )\n\n    return LaunchDescription([\n        declare_use_sim,\n        common_nodes,\n        sim_nodes,\n        real_nodes,\n    ])\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"debugging-integration-issues",children:"Debugging Integration Issues"}),"\n",(0,s.jsx)(n.h3,{id:"common-problems-and-solutions",children:"Common Problems and Solutions"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Problem"}),(0,s.jsx)(n.th,{children:"Symptoms"}),(0,s.jsx)(n.th,{children:"Solution"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"No data on ROS 2 topics"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"ros2 topic list"})," shows topic but ",(0,s.jsx)(n.code,{children:"echo"})," shows nothing"]}),(0,s.jsxs)(n.td,{children:["Check Gazebo topic name in ",(0,s.jsx)(n.code,{children:"gz topic -l"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Wrong frame IDs"}),(0,s.jsx)(n.td,{children:"TF errors in RViz2"}),(0,s.jsxs)(n.td,{children:["Verify ",(0,s.jsx)(n.code,{children:"frame_id"})," in sensor config"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Time synchronization"}),(0,s.jsx)(n.td,{children:"Stale data warnings"}),(0,s.jsxs)(n.td,{children:["Enable ",(0,s.jsx)(n.code,{children:"use_sim_time"})," parameter"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Bridge crashes"}),(0,s.jsx)(n.td,{children:"Segfault on startup"}),(0,s.jsx)(n.td,{children:"Check message type compatibility"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Missing transforms"}),(0,s.jsx)(n.td,{children:'"Could not find transform"'}),(0,s.jsxs)(n.td,{children:["Add ",(0,s.jsx)(n.code,{children:"robot_state_publisher"})," node"]})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"debugging-commands",children:"Debugging Commands"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="Debugging toolkit"',children:"# List all Gazebo topics\ngz topic -l\n\n# Echo a Gazebo topic\ngz topic -e -t /world/default/model/my_robot/link/camera_link/sensor/camera/image\n\n# List ROS 2 topics\nros2 topic list\n\n# Check bridge status\nros2 node info /ros_gz_bridge\n\n# Verify transforms\nros2 run tf2_tools view_frames\n\n# Check message types match\nros2 interface show sensor_msgs/msg/Image\ngz msg --info gz.msgs.Image\n"})}),"\n",(0,s.jsx)(n.h3,{id:"visualization-in-rviz2",children:"Visualization in RViz2"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:'title="Verify sensor data in RViz2"',children:"# Launch RViz2 with sim time\nros2 run rviz2 rviz2 --ros-args -p use_sim_time:=true\n\n# Add displays:\n# - LaserScan on /scan\n# - Image on /camera/image_raw\n# - TF\n# - RobotModel\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"exercise-1-complete-sensor-bridge",children:"Exercise 1: Complete Sensor Bridge"}),"\n",(0,s.jsxs)(n.admonition,{title:"Exercise 1: Bridge All Robot Sensors",type:"tip",children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Objective"}),": Configure a bridge for a robot with camera, LiDAR, and IMU."]}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Time Estimate"}),": 30 minutes"]}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Steps"}),":"]}),(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Create a ",(0,s.jsx)(n.code,{children:"sensor_bridge.yaml"})," configuration file"]}),"\n",(0,s.jsxs)(n.li,{children:["Add bridges for:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Camera image and camera_info"}),"\n",(0,s.jsx)(n.li,{children:"LiDAR scan"}),"\n",(0,s.jsx)(n.li,{children:"IMU data"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Launch Gazebo with your robot"}),"\n",(0,s.jsx)(n.li,{children:"Run the bridge"}),"\n",(0,s.jsx)(n.li,{children:"Verify all topics appear in ROS 2"}),"\n"]}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Verification"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Check all topics are publishing\nros2 topic hz /camera/image_raw\nros2 topic hz /scan\nros2 topic hz /imu\n"})}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Expected Result"}),": All three sensors publishing at expected rates (camera ~30Hz, LiDAR ~10Hz, IMU ~100Hz)."]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"exercise-2-teleoperation-setup",children:"Exercise 2: Teleoperation Setup"}),"\n",(0,s.jsxs)(n.admonition,{title:"Exercise 2: Keyboard Control of Simulated Robot",type:"tip",children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Objective"}),": Set up keyboard teleoperation for your simulated robot."]}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Time Estimate"}),": 20 minutes"]}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Steps"}),":"]}),(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Ensure differential drive plugin is configured"}),"\n",(0,s.jsx)(n.li,{children:"Add cmd_vel bridge (ROS_TO_GZ direction)"}),"\n",(0,s.jsx)(n.li,{children:"Launch simulation and bridge"}),"\n",(0,s.jsx)(n.li,{children:"Run teleop_twist_keyboard"}),"\n",(0,s.jsx)(n.li,{children:"Control the robot with keyboard"}),"\n"]}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Commands"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Terminal 1: Launch simulation\nros2 launch my_robot_description simulation.launch.py\n\n# Terminal 2: Keyboard teleop\nros2 run teleop_twist_keyboard teleop_twist_keyboard --ros-args -r cmd_vel:=/cmd_vel\n"})}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Expected Result"}),": Robot responds to WASD/arrow keys, moving and turning in Gazebo."]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"exercise-3-rviz2-visualization",children:"Exercise 3: RViz2 Visualization"}),"\n",(0,s.jsxs)(n.admonition,{title:"Exercise 3: Visualize Simulation in RViz2",type:"tip",children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Objective"}),": Configure RViz2 to show robot model, sensors, and transforms."]}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Time Estimate"}),": 25 minutes"]}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Steps"}),":"]}),(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Launch your simulation with all bridges"}),"\n",(0,s.jsxs)(n.li,{children:["Open RViz2 with ",(0,s.jsx)(n.code,{children:"use_sim_time:=true"})]}),"\n",(0,s.jsx)(n.li,{children:'Add TF display and set Fixed Frame to "odom"'}),"\n",(0,s.jsx)(n.li,{children:"Add RobotModel display"}),"\n",(0,s.jsx)(n.li,{children:"Add LaserScan display for /scan"}),"\n",(0,s.jsx)(n.li,{children:"Add Image display for /camera/image_raw"}),"\n",(0,s.jsx)(n.li,{children:"Save the configuration for future use"}),"\n"]}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Expected Result"}),": RViz2 shows the robot model with live sensor data overlaid on the 3D view."]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(n.p,{children:"In this chapter, you learned:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Bridge Architecture"}),": ros_gz connects Gazebo and ROS 2 via message translation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Configuration"}),": YAML files define topic mappings and directions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Launch Files"}),": Python launch files orchestrate simulation startup"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Sensor Integration"}),": Camera, LiDAR, and IMU bridges with proper frame IDs"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Control Integration"}),": Differential drive and joint state bridges"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Hardware Abstraction"}),": Write code that works in simulation and on real robots"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Debugging"}),": Tools and techniques for troubleshooting integration issues"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"With Gazebo-ROS 2 integration mastered, you can now develop and test robotics applications entirely in simulation before deploying to hardware."}),"\n",(0,s.jsxs)(n.p,{children:["Next, explore ",(0,s.jsx)(n.a,{href:"/docs/module-2/unity-robotics",children:"Unity for Robotics"})," for photorealistic simulation and synthetic data generation."]}),"\n",(0,s.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/gazebosim/ros_gz",children:"ros_gz Documentation"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Intermediate/Launch/Launch-Main.html",children:"ROS 2 Launch Tutorial"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://gazebosim.org/docs/harmonic/ros2_integration",children:"Gazebo-ROS 2 Migration Guide"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Concepts/About-Tf2.html",children:"TF2 Documentation"})}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);